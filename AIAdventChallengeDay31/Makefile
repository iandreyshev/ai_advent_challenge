.PHONY: install install-direct run run-direct run-direct-local run-en run-offline demo test test-mic help clean

# –û–ø—Ä–µ–¥–µ–ª—è–µ–º Python (–∏—Å–ø–æ–ª—å–∑—É–µ–º venv –µ—Å–ª–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
PYTHON := $(shell if [ -d "venv" ]; then echo "venv/bin/python"; else echo "python3"; fi)
PIP := $(shell if [ -d "venv" ]; then echo "venv/bin/pip"; else echo "pip3"; fi)

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
install:
	@echo "üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π..."
	@if [ ! -d "venv" ]; then \
		echo "üì¶ –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è..."; \
		python3 -m venv venv; \
	fi
	@$(PIP) install -r requirements.txt
	@echo "‚úÖ –ì–æ—Ç–æ–≤–æ!"

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –¥–ª—è –ø—Ä—è–º–æ–π –≤–µ—Ä—Å–∏–∏
install-direct:
	@echo "üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –¥–ª—è –ø—Ä—è–º–æ–π –≤–µ—Ä—Å–∏–∏..."
	@if [ ! -d "venv" ]; then \
		echo "üì¶ –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è..."; \
		python3 -m venv venv; \
	fi
	@$(PIP) install -r requirements-direct.txt
	@echo "‚úÖ –ì–æ—Ç–æ–≤–æ!"

# –ó–∞–ø—É—Å–∫ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ –∞–≥–µ–Ω—Ç–∞
run:
	@echo "üéôÔ∏è  –ó–∞–ø—É—Å–∫ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ –∞–≥–µ–Ω—Ç–∞..."
	@$(PYTHON) voice_agent.py

# –ó–∞–ø—É—Å–∫ –ø—Ä—è–º–æ–π –≤–µ—Ä—Å–∏–∏ —Å OpenAI Whisper API
run-direct:
	@echo "üéôÔ∏è  –ó–∞–ø—É—Å–∫ –ø—Ä—è–º–æ–π –≤–µ—Ä—Å–∏–∏ (OpenAI Whisper API)..."
	@$(PYTHON) voice_agent_direct.py --mode api

# –ó–∞–ø—É—Å–∫ –ø—Ä—è–º–æ–π –≤–µ—Ä—Å–∏–∏ —Å –ª–æ–∫–∞–ª—å–Ω—ã–º Whisper
run-direct-local:
	@echo "üéôÔ∏è  –ó–∞–ø—É—Å–∫ –ø—Ä—è–º–æ–π –≤–µ—Ä—Å–∏–∏ (–ª–æ–∫–∞–ª—å–Ω—ã–π Whisper)..."
	@$(PYTHON) voice_agent_direct.py --mode local

# –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ä–µ–∂–∏–º (–æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å)
demo:
	@echo "üé¨ –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ä–µ–∂–∏–º..."
	@$(PYTHON) demo.py

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞
test:
	@echo "üß™ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤..."
	@$(PYTHON) test_agent.py

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞
test-mic:
	@echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞..."
	@$(PYTHON) test_microphone.py

# –ó–∞–ø—É—Å–∫ —Å –∞–Ω–≥–ª–∏–π—Å–∫–∏–º —è–∑—ã–∫–æ–º
run-en:
	@echo "üéôÔ∏è  –ó–∞–ø—É—Å–∫ —Å –∞–Ω–≥–ª–∏–π—Å–∫–∏–º —è–∑—ã–∫–æ–º..."
	@$(PYTHON) voice_agent.py --language en-US

# –ó–∞–ø—É—Å–∫ –≤ –æ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º–µ (Sphinx)
run-offline:
	@echo "üéôÔ∏è  –ó–∞–ø—É—Å–∫ –≤ –æ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º–µ..."
	@$(PIP) install pocketsphinx
	@$(PYTHON) voice_agent.py --engine sphinx

# –û—á–∏—Å—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
clean:
	@echo "üßπ –û—á–∏—Å—Ç–∫–∞..."
	find . -type f -name "*.pyc" -delete
	find . -type d -name "__pycache__" -delete
	@echo "‚úÖ –ì–æ—Ç–æ–≤–æ!"

# –°–ø—Ä–∞–≤–∫–∞
help:
	@echo "üìñ –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:"
	@echo ""
	@echo "–£—Å—Ç–∞–Ω–æ–≤–∫–∞:"
	@echo "  make install           - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–±–∞–∑–æ–≤–∞—è –≤–µ—Ä—Å–∏—è)"
	@echo "  make install-direct    - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–ø—Ä—è–º–∞—è –≤–µ—Ä—Å–∏—è)"
	@echo ""
	@echo "–ó–∞–ø—É—Å–∫:"
	@echo "  make run               - –ó–∞–ø—É—Å—Ç–∏—Ç—å –≥–æ–ª–æ—Å–æ–≤–æ–π –∞–≥–µ–Ω—Ç (–±–∞–∑–æ–≤–∞—è –≤–µ—Ä—Å–∏—è)"
	@echo "  make run-direct        - –ü—Ä—è–º–∞—è –≤–µ—Ä—Å–∏—è —Å OpenAI Whisper API"
	@echo "  make run-direct-local  - –ü—Ä—è–º–∞—è –≤–µ—Ä—Å–∏—è —Å –ª–æ–∫–∞–ª—å–Ω—ã–º Whisper"
	@echo "  make demo              - –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ä–µ–∂–∏–º (1 –∑–∞–ø—Ä–æ—Å)"
	@echo ""
	@echo "–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:"
	@echo "  make test              - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞"
	@echo "  make test-mic          - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–∏–∫—Ä–æ—Ñ–æ–Ω"
	@echo ""
	@echo "–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ:"
	@echo "  make run-en            - –ó–∞–ø—É—Å–∫ —Å –∞–Ω–≥–ª–∏–π—Å–∫–∏–º —è–∑—ã–∫–æ–º"
	@echo "  make run-offline       - –ó–∞–ø—É—Å–∫ –≤ –æ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º–µ (Sphinx)"
	@echo "  make clean             - –û—á–∏—Å—Ç–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã"
	@echo "  make help              - –ü–æ–∫–∞–∑–∞—Ç—å —ç—Ç—É —Å–ø—Ä–∞–≤–∫—É"
